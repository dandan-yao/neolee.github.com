<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Web Service | Paradigm X]]></title>
  <link href="http://soulhacker.me/blog/categories/web-service/atom.xml" rel="self"/>
  <link href="http://soulhacker.me/"/>
  <updated>2014-03-18T16:05:52+08:00</updated>
  <id>http://soulhacker.me/</id>
  <author>
    <name><![CDATA[soulhacker]]></name>
    <email><![CDATA[neo@soulhacker.me]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Introducing RestKit]]></title>
    <link href="http://soulhacker.me/blog/2012/01/31/introducing-restkit/"/>
    <updated>2012-01-31T18:59:00+08:00</updated>
    <id>http://soulhacker.me/blog/2012/01/31/introducing-restkit</id>
    <content type="html"><![CDATA[<p><a href="http://restkit.org/">RestKit</a> is an amazing <strong>Objective-C framework for iOS</strong> that aims to make interacting with RESTful web services simple, fast and fun. As said on its homepage:</p>

<p><blockquote><p>It combines a clean, simple HTTP request/response API with a powerful object mapping system that reduces the amount of code you need to write to get stuff done.</p></blockquote>
<!-- more -->
RestKit provides several components: </p>

<ol>
  <li><strong>An HTTP client component</strong> based on <code>NSURLConnection</code>. It’s not as feature-packed as ASIHTTPRequest<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>, but it does its part very well in most cases. It supports <code>GET</code> <code>POST</code> <code>PUT</code> <code>DELETE</code>, <code>SSL</code> &amp; <code>HTTP AUTH</code>, multi-part, etc. It even provides a request queue to manage the HTTP requests(mostly implicitly), making them more memory and bandwidth efficient.</li>
  <li><strong>A powerful but elegant object mapping system</strong>, which uses idiomatic key-value coding mechanism to define and implement the round-trip transformation between <code>JSON</code><sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup> string and native Objective-C class. Well, the magic behind it is called <a href="https://github.com/jverkoey/sockit">SOCKit</a><sup id="fnref:3"><a href="#fn:3" rel="footnote">3</a></sup>.</li>
  <li><strong>A persistent layer</strong> built on top of the object mapping system, fully integrated with CoreData. Can be used as app’s primary data storage or just local cache.</li>
  <li><strong>Miscellaneous helpers</strong> for better life. Reachability, database seeding, API environments switching, etc.  </li>
</ol>

<p>Other than making another almighty monster its creators focus on the remote-local object (can be transient or persistent through CoreData) mapping. They made it through the ‘<em>common things simple, others possible</em>’ philosophy, which I always love.</p>

<p>RestKit has some <a href="https://github.com/RestKit/RestKit/wiki">documentations</a> but not very well organized. Maybe it’s the biggest problem for beginners. So I’d like to list below some most useful solution recipes I’ve used in real world project, updated progressively.</p>

<p><strong>**<em>WARNING</em>**</strong>: it will be incredibly long anyway.</p>

<h3 id="setting-up">Setting up</h3>
<p>RestKit provides two ways to set up the RestKit client: <code>RKClient</code> and <code>RKObjectManager</code>. If you want to manually handle the return data you should use <code>RKClient</code>. Otherwise, if you want to use the RestKit object mapping system, then <code>RKObjectManager</code> is the one. 
<div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">// API base (and the whole API environment) can be switched by</span>
</span><span class='line'><span class="cp">#define gkBaseURL @”https:</span><span class="c1">//api.domain.com/v2”&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">RKObjectManager</span><span class="o">*</span> <span class="n">manager</span> <span class="o">=</span> <span class="p">[</span><span class="n">RKObjectManager</span> <span class="nl">objectManagerWithBaseURL:</span><span class="n">gkBaseURL</span><span class="p">];</span>
</span><span class='line'><span class="n">NSLog</span><span class="p">(</span><span class="err">@”</span><span class="n">I</span> <span class="n">am</span> <span class="n">your</span> <span class="n">RKObjectManager</span> <span class="n">singleton</span> <span class="o">:</span> <span class="o">%</span><span class="err">@”</span><span class="p">,</span> <span class="n">manager</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="c1">// Or you can use</span>
</span><span class='line'><span class="n">RKClient</span> <span class="o">*</span><span class="n">client</span> <span class="o">=</span> <span class="p">[</span><span class="n">RKClient</span> <span class="nl">clientWithBaseURL:</span><span class="n">gkBaseURL</span><span class="p">];</span>
</span><span class='line'><span class="n">NSLog</span><span class="p">(</span><span class="err">@”</span><span class="n">I</span> <span class="n">am</span> <span class="n">your</span> <span class="n">RKClient</span> <span class="n">singleton</span> <span class="o">:</span> <span class="o">%</span><span class="err">@”</span><span class="p">,</span> <span class="n">client</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
RestKit uses a convenient convention: the first initialized client object becomes a singleton and can be referenced by <code>[RKClient sharedClient]</code> or <code>[RKObjectManager sharedManager]</code> correspondingly. </p>

<p>In real world we usually have more than one base URLs, say, one for product environment, the second for testing and third for developing. The base URL can be easily changed globally:
<div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[[</span><span class="n">RKClient</span> <span class="n">sharedClient</span><span class="p">]</span> <span class="nl">setBaseURL:</span><span class="err">@”</span><span class="nl">https:</span><span class="c1">//api.domain.com/v2d”];</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
Note that change base URL while app is running may bring some side effects. See <a href="http://restkit.org/api/0.9/Classes/RKClient.html#//api/name/baseURL">the API document</a> for detail.</p>

<p><code>RKClient</code> acts just like a plain asynchronous HTTP client. You can send any HTTP request through its intuitive interface:
<div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">@interface</span> <span class="nc">User</span> : <span class="nc">NSObject</span> <span class="o">&lt;</span><span class="n">rkrequestdelegate</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;/</span><span class="n">rkrequestdelegate</span><span class="o">&gt;&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">@implementation</span> <span class="nc">User</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">ul</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">send</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// HTTP GET</span>
</span><span class='line'>  <span class="p">[</span> <span class="p">[</span><span class="n">RKClient</span> <span class="n">sharedClient</span><span class="p">]</span> <span class="nl">get:</span><span class="err">@”</span><span class="n">users</span><span class="o">/</span><span class="n">self</span><span class="err">”</span> <span class="nl">delegate:</span><span class="n">self</span><span class="p">];</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="c1">// HTTP POST. Note the transparent NSDictionary conversion</span>
</span><span class='line'>  <span class="n">NSDictionary</span><span class="o">*</span> <span class="n">params</span> <span class="o">=</span>
</span><span class='line'>      <span class="p">[</span><span class="n">NSDictionary</span> <span class="nl">dictionaryWithObjectsAndKeys:</span><span class="n">_userName</span><span class="p">,</span> <span class="err">@”</span><span class="n">userName</span><span class="err">”</span><span class="p">,</span>
</span><span class='line'>                                                 <span class="n">_password</span><span class="p">,</span> <span class="err">@”</span><span class="n">password</span><span class="err">”</span><span class="p">,</span> <span class="nb">nil</span><span class="p">];</span>
</span><span class='line'>  <span class="p">[</span> <span class="p">[</span><span class="n">RKClient</span> <span class="n">sharedClient</span><span class="p">]</span> <span class="nl">post:</span><span class="err">@”</span><span class="n">users</span><span class="o">/</span><span class="n">login</span><span class="err">”</span> <span class="nl">params:</span><span class="n">params</span> <span class="nl">delegate:</span><span class="n">self</span><span class="p">];</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="c1">// HTTP DELETE</span>
</span><span class='line'>  <span class="p">[</span> <span class="p">[</span><span class="n">RKClient</span> <span class="n">sharedClient</span><span class="p">]</span> <span class="nl">delete:</span><span class="err">@”</span><span class="n">users</span><span class="o">/</span><span class="mi">13</span><span class="err">”</span> <span class="nl">delegate:</span><span class="n">self</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">ul</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="c1">// The delegate handles the response data when its fully loaded</span>
</span><span class='line'><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nl">request:</span><span class="p">(</span><span class="n">RKRequest</span><span class="o">&lt;</span><span class="n">em</span><span class="o">&gt;</span><span class="p">)</span><span class="n">request</span> <span class="nl">didLoadResponse:</span><span class="p">(</span><span class="n">RKResponse</span><span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;</span><span class="p">)</span><span class="n">response</span> <span class="p">{</span><span class="o">&lt;</span><span class="n">br</span> <span class="o">/&gt;</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">([</span><span class="n">request</span> <span class="n">isGET</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">([</span><span class="n">response</span> <span class="n">isOK</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">NSLog</span><span class="p">(</span><span class="err">@”</span><span class="n">Data</span> <span class="nl">returned:</span> <span class="o">%</span><span class="err">@”</span><span class="p">,</span> <span class="p">[</span><span class="n">response</span> <span class="n">bodyAsString</span><span class="p">]);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">([</span><span class="n">request</span> <span class="n">isPOST</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">([</span><span class="n">response</span> <span class="n">isJSON</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">NSLog</span><span class="p">(</span><span class="err">@”</span><span class="n">POST</span> <span class="n">returned</span> <span class="n">a</span> <span class="n">JSON</span> <span class="n">response</span><span class="err">”</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">([</span><span class="n">request</span> <span class="n">isDELETE</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">([</span><span class="n">response</span> <span class="n">isNotFound</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">NSLog</span><span class="p">(</span><span class="err">@”</span><span class="n">Resource</span> <span class="err">‘</span><span class="o">%</span><span class="err">@’</span> <span class="n">not</span> <span class="n">exists</span><span class="err">”</span><span class="p">,</span> <span class="p">[</span><span class="n">request</span> <span class="n">resourcePath</span><span class="p">]);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
By using <code>RKObjectManager</code> you’ll map the web resources to local Objective-C objects, so you need not (and cannot) handle the return data explicitly. Instead you should handle data through the mapping system, which will be discussed below.</p>

<h3 id="modeling-and-mapping">Modeling and Mapping</h3>
<p>Now the object mapping system. Let’s start with the best practice in RESTful API backed mobile app development:
<blockquote><p>1. Analyze the business and make abstraction.<br/>2. Design the RESTful API spec based on the first step, including all call endpoints, parameters and returning data in JSON format.<br/>3. Mapping the API spec to native code in designated mobile platform.</p></blockquote>
Assuming we have a simple API named <code>users/login</code>, accepting POST request with 2 parameters: <code>username</code> and <code>password</code>, doing login check, and returning a encrypted access <code>token</code> and corresponding <code>user</code> object. And as a global convention we encapsulate the payload as <code>response</code> section in a JSON string which also contains a <code>meta</code> section for system level info such as status code and error message. So here it looks like:
<div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="err">“</span><span class="nx">meta</span><span class="err">”</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="err">“</span><span class="nx">code</span><span class="err">”</span><span class="o">:</span> <span class="mi">200</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="err">“</span><span class="nx">response</span><span class="err">”</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="err">“</span><span class="nx">token</span><span class="err">”</span><span class="o">:</span> <span class="err">“</span><span class="mi">931240153764834717</span> <span class="mi">156605143238420655</span><span class="err">”</span><span class="p">,</span>
</span><span class='line'>        <span class="err">“</span><span class="nx">user</span><span class="err">”</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="err">“</span><span class="nx">user_name</span><span class="err">”</span><span class="o">:</span> <span class="err">“</span><span class="nx">soulhacker</span><span class="err">”</span><span class="p">,</span>
</span><span class='line'>            <span class="err">“…”</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
It’s simple but not trivial, and very <em>representative</em>. What will the mapping work? Have a look at the code first:
<div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#pragma Mark - Class Meta&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">@interface</span> <span class="nc">Meta</span> : <span class="nc">NSObject</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">readonly</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">code</span><span class="p">;</span>
</span><span class='line'><span class="k">@end</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">@implementation</span> <span class="nc">Meta</span>
</span><span class='line'><span class="k">@synthesize</span> <span class="n">code</span> <span class="o">=</span> <span class="n">_code</span><span class="p">;</span>
</span><span class='line'><span class="k">@end</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span> <span class="kt">id</span><span class="o">=</span><span class="s">&quot;pragma-mark---class-user&quot;</span><span class="o">&gt;</span><span class="n">pragma</span> <span class="n">Mark</span> <span class="o">-</span> <span class="n">Class</span> <span class="n">User</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">@interface</span> <span class="nc">User</span> : <span class="nc">NSObject</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">readonly</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">userName</span><span class="p">;</span>
</span><span class='line'><span class="c1">// Many stuff omitted here</span>
</span><span class='line'><span class="k">@end</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">@implementation</span> <span class="nc">User</span>
</span><span class='line'><span class="k">@synthesize</span> <span class="n">userName</span> <span class="o">=</span> <span class="n">_userName</span><span class="p">;</span>
</span><span class='line'><span class="c1">// Many stuff omitted here</span>
</span><span class='line'><span class="k">@end</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span> <span class="kt">id</span><span class="o">=</span><span class="s">&quot;pragma-mark---class-userslogin&quot;</span><span class="o">&gt;</span><span class="n">pragma</span> <span class="n">Mark</span> <span class="o">-</span> <span class="n">Class</span> <span class="n">UsersLogin</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">@interface</span> <span class="nc">UsersLogin</span> : <span class="nc">NSObject</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">readonly</span><span class="p">)</span> <span class="n">Meta</span> <span class="o">*</span><span class="n">meta</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">readonly</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">token</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">readonly</span><span class="p">)</span> <span class="n">User</span> <span class="o">*</span><span class="n">user</span><span class="p">;</span>
</span><span class='line'><span class="k">@end</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">@implementation</span> <span class="nc">UsersLogin</span>
</span><span class='line'><span class="k">@synthesize</span> <span class="n">meta</span> <span class="o">=</span> <span class="n">_meta</span><span class="p">;</span>
</span><span class='line'><span class="k">@synthesize</span> <span class="n">token</span> <span class="o">=</span> <span class="n">_token</span><span class="p">;</span>
</span><span class='line'><span class="k">@synthesize</span> <span class="n">user</span> <span class="o">=</span> <span class="n">_user</span><span class="p">;</span>
</span><span class='line'><span class="k">@end</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span> <span class="kt">id</span><span class="o">=</span><span class="s">&quot;pragma-mark---class-usersloginrequest&quot;</span><span class="o">&gt;</span><span class="n">pragma</span> <span class="n">Mark</span> <span class="o">-</span> <span class="n">Class</span> <span class="n">UsersLoginRequest</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">@interface</span> <span class="nc">UsersLoginRequest</span> : <span class="nc">NSObject</span> <span class="o">&lt;</span><span class="n">rkobjectloaderdelegate</span><span class="o">&gt;</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">retain</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">userName</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">retain</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">password</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">rkobjectloaderdelegate</span><span class="o">&gt;&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">ul</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;</span><span class="p">(</span><span class="n">UsersLoginRequest</span> <span class="o">*</span><span class="p">)</span><span class="nl">initWithUserName:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="n">userName</span> <span class="nl">password:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="n">password</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">login</span><span class="p">;</span>
</span><span class='line'><span class="k">@end</span><span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">ul</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">@implementation</span> <span class="nc">UsersLoginRequest</span>
</span><span class='line'><span class="c1">// Even more stuff omitted here&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">ul</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">login</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">RKObjectMapping</span> <span class="o">*</span><span class="n">metaMapping</span> <span class="o">=</span> <span class="p">[</span><span class="n">RKObjectMapping</span> <span class="nl">mappingForClass:</span><span class="p">[</span><span class="n">Meta</span> <span class="n">class</span><span class="p">]];</span>
</span><span class='line'>  <span class="p">[</span><span class="n">metaMapping</span> <span class="nl">mapAttributes:</span><span class="err">@”</span><span class="n">code</span><span class="err">”</span><span class="p">,</span> <span class="nb">nil</span><span class="p">];</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">RKObjectMapping</span> <span class="o">*</span><span class="n">userMapping</span> <span class="o">=</span> <span class="p">[</span><span class="n">RKObjectMapping</span> <span class="nl">mappingForClass:</span><span class="p">[</span><span class="n">User</span> <span class="n">class</span><span class="p">]];</span>
</span><span class='line'>  <span class="p">[</span><span class="n">userMapping</span> <span class="nl">mapKeyPath:</span><span class="err">@”</span><span class="n">user_name</span><span class="err">”</span> <span class="nl">toAttribute:</span><span class="err">@”</span><span class="n">userName</span><span class="err">”</span><span class="p">];</span>
</span><span class='line'>  <span class="c1">// More mapping for userMapping&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">RKObjectMapping</span> <span class="o">*</span><span class="n">mapping</span> <span class="o">=</span> <span class="p">[</span><span class="n">RKObjectMapping</span> <span class="nl">mappingForClass:</span><span class="p">[</span><span class="n">UsersLogin</span> <span class="n">class</span><span class="p">]];</span>
</span><span class='line'>  <span class="p">[</span><span class="n">mapping</span> <span class="nl">mapKeyPath:</span><span class="err">@”</span><span class="n">response</span><span class="p">.</span><span class="n">token</span><span class="err">”</span> <span class="nl">toAttribute:</span><span class="err">@”</span><span class="n">token</span><span class="err">”</span><span class="p">];</span>
</span><span class='line'>  <span class="p">[</span><span class="n">mapping</span> <span class="nl">mapKeyPath:</span><span class="err">@”</span><span class="n">meta</span><span class="err">”</span> <span class="nl">toRelationship:</span><span class="err">@”</span><span class="n">meta</span><span class="err">”</span> <span class="nl">withMapping:</span><span class="n">metaMapping</span><span class="p">];</span>
</span><span class='line'>  <span class="p">[</span><span class="n">mapping</span> <span class="nl">mapKeyPath:</span><span class="err">@”</span><span class="n">user</span><span class="err">”</span> <span class="nl">toRelationship:</span><span class="err">@”</span><span class="n">user</span><span class="err">”</span> <span class="nl">withMapping:</span><span class="n">userMapping</span><span class="p">];</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="c1">// Make the call</span>
</span><span class='line'>  <span class="n">NSDictionary</span><span class="o">*</span> <span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSDictionary</span> <span class="nl">dictionaryWithObjectsAndKeys:</span><span class="n">_userName</span><span class="p">,</span> <span class="err">@”</span><span class="n">userName</span><span class="err">”</span><span class="p">,</span> <span class="n">_password</span><span class="p">,</span> <span class="err">@”</span><span class="n">password</span><span class="err">”</span><span class="p">,</span> <span class="nb">nil</span><span class="p">];</span>
</span><span class='line'>  <span class="n">NSString</span> <span class="o">*</span><span class="n">endpoint</span> <span class="o">=</span> <span class="err">@”</span><span class="n">users</span><span class="o">/</span><span class="n">login</span><span class="o">?</span><span class="err">”</span><span class="p">;</span>
</span><span class='line'>  <span class="n">NSString</span> <span class="o">*</span><span class="n">resourcePath</span> <span class="o">=</span> <span class="p">[</span><span class="n">endpoint</span> <span class="nl">stringByAppendingString:</span><span class="p">[</span><span class="n">params</span> <span class="n">queryString</span><span class="p">]];</span>
</span><span class='line'>  <span class="p">[[</span><span class="n">RKObjectManager</span> <span class="n">sharedManager</span><span class="p">]</span> <span class="nl">loadObjectsAtResourcePath:</span><span class="n">resourcePath</span> <span class="nl">objectMapping:</span><span class="n">mapping</span> <span class="nl">delegate:</span><span class="n">self</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">ul</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span> <span class="kt">id</span><span class="o">=</span><span class="s">&quot;pragma-mark---rkobjectloaderdelegate&quot;</span><span class="o">&gt;</span><span class="n">pragma</span> <span class="n">Mark</span> <span class="o">-</span> <span class="n">RKObjectLoaderDelegate</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">ul</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nl">objectLoader:</span><span class="p">(</span><span class="n">RKObjectLoader</span> <span class="o">*</span><span class="p">)</span><span class="n">objectLoader</span> <span class="nl">didLoadObjects:</span><span class="p">(</span><span class="n">NSArray</span> <span class="o">*</span><span class="p">)</span><span class="n">objects</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">UsersLogin</span> <span class="o">*</span><span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">objects</span> <span class="nl">objectAtIndex:</span><span class="mi">0</span><span class="p">];</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">NSLog</span><span class="p">(</span><span class="err">@”</span><span class="n">Response</span> <span class="n">code</span><span class="o">=%</span><span class="err">@</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="p">[</span><span class="o">%</span><span class="err">@</span><span class="p">],</span> <span class="n">userName</span><span class="o">=</span><span class="p">[</span><span class="o">%</span><span class="err">@</span><span class="p">]</span><span class="err">”</span><span class="p">,</span> <span class="p">[[</span><span class="n">result</span> <span class="n">meta</span><span class="p">]</span> <span class="n">code</span><span class="p">],</span> <span class="p">[</span><span class="n">result</span> <span class="n">token</span><span class="p">],</span> <span class="p">[[</span><span class="n">result</span> <span class="n">user</span><span class="p">]</span> <span class="n">userName</span><span class="p">]);</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nl">objectLoader:</span><span class="p">(</span><span class="n">RKObjectLoader</span> <span class="o">&lt;</span><span class="n">em</span><span class="o">&gt;</span><span class="p">)</span><span class="n">objectLoader</span> <span class="nl">didFailWithError:</span><span class="p">(</span><span class="n">NSError</span> <span class="o">*</span><span class="p">)</span><span class="n">error</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">NSLog</span><span class="p">(</span><span class="err">@”</span><span class="n">Error</span><span class="o">!</span><span class="err">”</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<strong>Line 1-35</strong>. Firstly we defined all needed model classes: fundamental ones first, ones that contain them next. Just follow the nature of the data structure within the API’s response data.<br />
<strong>Line 51-56</strong>. Use instances of <code>RKObjectMapping</code> class to define object mappings. Simple mappings are self explained. Note that <code>RKObjectMapping</code> provides several different <code>mapXXX</code> methods to suit different use cases. The key path in mapping definition fully follows Cocoa’s key path style (also support <a href="http://developer.apple.com/library/ios/#documentation/cocoa/conceptual/KeyValueCoding/Articles/CollectionOperators.html">collection operators</a>). Check <a href="http://restkit.org/api/master/Classes/RKObjectManager.html">its document</a> and Apple’s <a href="http://developer.apple.com/library/ios/#documentation/cocoa/conceptual/KeyValueCoding/Articles/KeyValueCoding.html">Key Value Coding Guide</a> for detail.<br />
<strong>Line 58-61</strong>. Complex object mappings are defined by <code>mapKeyPath:toRelationship:withMapping:</code> or similar methods. They map some key path to pre-defined object mappings. As seen in the code, the mapping to class <code>UsersLogin</code> contains simple mapping (</em>line 59<em>) and relationship mappings (</em>line 60-61<em>).<br />
<strong>Line 64-67</strong>. <code>RKObjectManager</code> provides <code>loadObjectsAtResourcePath:objectMapping:delegate:</code> method to do these steps in order: combine resource path with the global <code>BaseURL</code> (configured within the <code>RKObjectManager</code> singleton), load resource from web services, parse return data, transform to local objects according to pre-defined <code>RKObjectMapping</code> instance, at last call the delegate to handle result.<br />
<strong>Line 72-80</strong>. Delegate methods <code>didLoadObjects</code> and <code>didFailWithError</code> (</em>required*) are called after the object mapping process. Normally fetch the result object and do whatever you want.</p>
  </li>
</ul>

<h3 id="routing">Routing</h3>
<p>The previous code list is neat except one part. Note <strong>line 64-66</strong>, in which we hard-code the API endpoint and parameters. In our <code>login</code> scenario it may not be a big problem, but for highly reused objects, repeatedly constructing <code>GET</code> <code>POST</code> <code>PUT</code> <code>DELETE</code> URLs by hand could be real pain in the ass. How about more object-oriented and more elegant way, just like the <a href="http://guides.rubyonrails.org/routing.html">routing system in Ruby on Rails</a>?</p>

<p>RestKit is most suitable for developers who has RoR background because of its <strong>Routing</strong> system which is highly alike to RoR’s, but built on Cocoa’s idiomatic key-value coding way. Here is the code sample:
<div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">// The router belongs to the object manager, just as mappers</span>
</span><span class='line'><span class="n">RKObjectRouter</span> <span class="o">*</span><span class="n">router</span> <span class="o">=</span> <span class="p">[[</span><span class="n">RKObjectManager</span> <span class="n">sharedManager</span><span class="p">]</span> <span class="n">router</span><span class="p">];</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="p">[</span><span class="n">router</span> <span class="nl">routeClass:</span><span class="p">[</span><span class="n">User</span> <span class="n">class</span><span class="p">]</span> <span class="nl">toResourcePath:</span><span class="err">@”</span><span class="o">/</span><span class="n">users</span><span class="o">/:</span><span class="kt">id</span><span class="err">”</span><span class="p">];</span>
</span><span class='line'><span class="p">[</span><span class="n">router</span> <span class="nl">routeClass:</span><span class="p">[</span><span class="n">User</span> <span class="n">class</span><span class="p">]</span> <span class="nl">toResourcePath:</span><span class="err">@”</span><span class="o">/</span><span class="n">users</span><span class="err">”</span> <span class="nl">forMethod:</span><span class="n">RKRequestMethodPOST</span><span class="p">];</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="c1">// Then we can call the GET POST PUT DELETE verbs directly from object manager</span>
</span><span class='line'><span class="n">User</span> <span class="o">*</span><span class="n">me</span> <span class="o">=</span> <span class="p">[[</span><span class="n">User</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'><span class="n">me</span><span class="p">.</span><span class="n">userName</span> <span class="o">=</span> <span class="err">@”</span><span class="n">soulhacker</span><span class="err">”</span><span class="p">;</span>
</span><span class='line'><span class="p">[[</span><span class="n">RKObjectManager</span> <span class="n">sharedManager</span><span class="p">]</span> <span class="nl">postObject:</span><span class="n">me</span> <span class="nl">delegate:</span><span class="n">self</span><span class="p">];</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">User</span> <span class="o">*</span><span class="n">sb2nuke</span> <span class="o">=</span> <span class="p">[[</span><span class="n">User</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'><span class="n">sb2nuke</span><span class="p">.</span><span class="kt">id</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSNumber</span> <span class="nl">numberWithInt:</span><span class="mi">13</span><span class="p">];</span>
</span><span class='line'><span class="p">[[</span><span class="n">RKObjectManager</span> <span class="n">sharedManager</span><span class="p">]</span> <span class="nl">deleteObject:</span><span class="n">sb2nuke</span> <span class="nl">delegate:</span><span class="n">self</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<strong>Line 4</strong> set the <em>default</em> route of <code>User</code> class, which means when you call object manager’s <code>getObject</code> <code>postObject</code> <code>putObject</code> <code>deleteObject</code> methods the requests will go to <code>@"/users/:id"</code>. This is a colon coded endpoint and what is after the colon is the name of a <em>method</em> in the route class, whose return value will replace the colon part.<br />
<strong>Line 5</strong> set a special route for <code>postObject</code> method, which will override the setting in default route.<br />
<strong>Line 10</strong> requests <code>@"/users"</code> with HTTP <code>POST</code> method and RestKit will transform <code>me</code> object into post data form as the way defined in object mapper of class User.<br />
<strong>Line 14</strong> first call <code>[sb2nuke id]</code> method to get the value and replace <code>:id</code> with it, then requests <code>@"/users/13"</code> with HTTP <code>DELETE</code> method, which (should) remove the user object with id 13 from the server.</p>

<p>So you see, RestKit provides very flexible tools for RESTful web services integration: you can use the network layer and do all data mapping by hand, or you can use the object mapping to do it completely within local object system, or you can tuning it in some intermediate way. No matter which solution you choose remember to align the protocol between the server and client side, and don’t forget to verify them to the Android platform if necessary (there is no RestKit over there for now -_-).</p>

<p>Thus we’ve completed the first part of this introduction guide. Below we will discuss some facilities bundled in RestKit to make our life better.</p>

<h3 id="the-request-queue">The Request Queue</h3>
<p>Request queue is the most important support player under the hood. <code>RKRequestQueue</code> is behind nearly all network access within RestKit and provides elegant solution for critical memory and bandwidth problems. <code>RKRequestQueue</code> wraps memory management within RestKit framework so you’ll never see any <code>retain</code> <code>release</code> <code>autorelease</code> for <code>RKRequest</code> <code>RKResponse</code> instances. It let us developers focus on the business with very little concern about the memory management. </p>

<p><code>RKRequestQueue</code> also provides seamless integration with Reachability API (in iOS System Configuration framework), pooling all requests when network is unavailable, and limiting concurrent requests when network becomes reachable to prevent overburden as well.</p>

<p>All the amazing features described above are working without knowing, and maybe the only visible part of <code>RKRequestQueue</code> is its <em>request lifecycle management</em> feature, by which you can cancel ongoing requests to prevent wasting the bandwidth. This is a common situation in mobile apps that when some user action generates a bunch of network requests and the following action actually makes those requests useless (e.g. the view for previous action is dismissed by the later action). By using <code>RKRequestQueue</code> we can do it very easily by its <code>cancelRequest:</code> <code>cancelRequestsWithDelegate:</code> and  cancelAllRequests:` methods. And remember that whether and when to call them is fully determined by developers so you can choose the strategy wisely according to the different scenarios. Here is the simplest sample:
<div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewWillAppear:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">animated</span> <span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="n">RKClient</span> <span class="n">sharedClient</span><span class="p">]</span> <span class="nl">get:</span><span class="err">@”</span><span class="n">users</span><span class="o">/</span><span class="n">self</span><span class="err">”</span> <span class="nl">delegate:</span><span class="n">self</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">ul</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nl">viewWillDisappear:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="n">animated</span> <span class="p">{</span>
</span><span class='line'>  <span class="p">[[</span><span class="n">RKRequestQueue</span> <span class="n">sharedQueue</span><span class="p">]</span> <span class="nl">cancelRequestsWithDelegate:</span><span class="n">self</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
The <code>cancelRequestsWithDelegate:</code> method cancel all requests that current controller is delegate for. If there are no one processing it’ll do nothing.</li>
</ul>

<p>The last but not least. What <code>[RKRequestQueue sharedQueue]</code> returns is the default queue which created automatically when the RestKit client initialized. In most real world apps it’s not enough. For example we may need a queue to handle special resource intensive tasks in a background thread, such as data uploading/downloading, while the default queue keep working for  responding user actions. It’s easy:
<div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">RKRequestQueue</span><span class="o">*</span> <span class="n">queue</span> <span class="o">=</span> <span class="p">[[</span><span class="n">RKRequestQueue</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'><span class="n">queue</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
</span><span class='line'><span class="n">queue</span><span class="p">.</span><span class="n">concurrentRequestsLimit</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span><span class='line'><span class="n">queue</span><span class="p">.</span><span class="n">showsNetworkActivityIndicatorWhenBusy</span> <span class="o">=</span> <span class="n">YES</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="c1">// Add some requests to it and make it start</span>
</span><span class='line'><span class="p">[</span><span class="n">queue</span> <span class="nl">addRequest:</span><span class="p">[</span>
</span><span class='line'>    <span class="p">[</span><span class="n">RKClient</span> <span class="n">sharedClient</span><span class="p">]</span> <span class="nl">requestWithResourcePath:</span><span class="err">@”</span><span class="n">users</span><span class="o">/</span><span class="mi">1</span><span class="err">”</span> <span class="nl">delegate:</span><span class="n">self</span><span class="p">]];</span>
</span><span class='line'><span class="p">[</span><span class="n">queue</span> <span class="nl">addRequest:</span><span class="p">[</span>
</span><span class='line'>    <span class="p">[</span><span class="n">RKClient</span> <span class="n">sharedClient</span><span class="p">]</span> <span class="nl">requestWithResourcePath:</span><span class="err">@”</span><span class="n">users</span><span class="o">/</span><span class="mi">2</span><span class="err">”</span> <span class="nl">delegate:</span><span class="n">self</span><span class="p">]];</span>
</span><span class='line'><span class="p">[</span><span class="n">queue</span> <span class="nl">addRequest:</span><span class="p">[</span>
</span><span class='line'>    <span class="p">[</span><span class="n">RKClient</span> <span class="n">sharedClient</span><span class="p">]</span> <span class="nl">requestWithResourcePath:</span><span class="err">@”</span><span class="n">users</span><span class="o">/</span><span class="mi">3</span><span class="err">”</span> <span class="nl">delegate:</span><span class="n">self</span><span class="p">]];</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="p">[</span><span class="n">queue</span> <span class="n">start</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h3 id="reachability">Reachability</h3>
<p>Reachability is the problem all mobile apps have to face and of course iOS provides solution for that, well, sort of. The problem is: <code>SCNetworkReachability</code> (in <code>SystemConfiguration</code> framework) is implemented as low level C APIs and not so easy to use. Fortunately RestKit is bundled with a very straight-forward Objective-C wrapper for that, the <code>RKReachabilityObserver</code>.</p>

<p>When RKClient (or RKObjectManager) is initialized with some base URL, RestKit automatically initializes an instance of RKReachabilityObserver targeted at the host specified in the base URL and can be accessed via <code>baseURLReachabilityObserver</code> property. This observer also automatically registers <code>RKReachabilityStateChangedNotification</code> events in the default notification center. So in most cases we can use it in very simple way:
<div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">init</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">((</span><span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="n">init</span><span class="p">]))</span> <span class="p">{</span>
</span><span class='line'>        <span class="p">[[</span><span class="n">NSNotificationCenter</span> <span class="n">defaultCenter</span><span class="p">]</span> <span class="nl">addObserver:</span><span class="n">self</span>
</span><span class='line'>            <span class="nl">selector:</span><span class="k">@selector</span><span class="p">(</span><span class="nl">reachabilityChanged:</span><span class="p">)</span>
</span><span class='line'>            <span class="nl">name:</span><span class="n">RKReachabilityStateChangedNotification</span>
</span><span class='line'>            <span class="nl">object:</span><span class="nb">nil</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="k">return</span> <span class="n">self</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">ul</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nl">reachabilityChanged:</span><span class="p">(</span><span class="n">NSNotification</span><span class="o">*</span><span class="p">)</span><span class="n">notification</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">RKReachabilityObserver</span> <span class="o">*</span><span class="n">observer</span> <span class="o">=</span> <span class="p">(</span><span class="n">RKReachabilityObserver</span> <span class="o">*</span><span class="p">)[</span><span class="n">notification</span> <span class="n">object</span><span class="p">];</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">if</span> <span class="p">([</span><span class="n">observer</span> <span class="n">isNetworkAvailable</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">NSLog</span><span class="p">(</span><span class="err">@”</span><span class="n">We</span><span class="err">’</span><span class="n">re</span> <span class="n">online</span><span class="o">!</span><span class="err">”</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span>  <span class="k">if</span> <span class="p">(</span><span class="n">RKReachabilityReachableViaWiFi</span> <span class="o">==</span> <span class="p">[</span><span class="n">observer</span> <span class="n">networkStatus</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;…via WiFi.&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">RKReachabilityReachableViaWWAN</span> <span class="o">==</span> <span class="p">[</span><span class="n">observer</span> <span class="n">networkStatus</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;…via mobile network.&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>   <span class="p">}</span>   <span class="k">else</span> <span class="k">if</span> <span class="p">([</span><span class="n">observer</span> <span class="n">isConnectionRequired</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Mobile network may be available if we open a connection...&quot;</span><span class="p">);</span>   <span class="p">}</span>    <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;We&#39;re offline!&quot;</span><span class="p">);</span>   <span class="p">}</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
</code></pre>
  </li>
</ul>

<h3 id="sending-multi-part-data">Sending Multi-part Data</h3>
<p>Sending multi-part data through HTTP requests is very common requirement and incredibly difficult in most programming languages. RestKit uses <code>RKParams</code> and <code>RKParamsAttachment</code> to handle that problem. <code>RKParams</code> is the container that can hold any kinds of parameters. For simple data type it works just like a NSDictionary, and for multi-part data it can wrap <code>NSData</code> and/or <code>RKParamsAttachment</code> objects. Both <code>RKParams</code> and <code>RKParamsAttachment</code> are MIME type friendly. The following self-explained code sample shows all:
<div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">NSString</span><span class="o">*</span> <span class="n">filePath</span> <span class="o">=</span> <span class="err">@”</span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">avatar</span><span class="p">.</span><span class="n">jpg</span><span class="err">”</span><span class="p">;</span>
</span><span class='line'><span class="n">RKParams</span><span class="o">*</span> <span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="n">RKParams</span> <span class="n">params</span><span class="p">];</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="p">[</span><span class="n">params</span> <span class="nl">setValue:</span><span class="err">@”</span><span class="n">Neo</span><span class="err">”</span> <span class="nl">forParam:</span><span class="err">@”</span><span class="n">name</span><span class="err">”</span><span class="p">];</span>
</span><span class='line'><span class="p">[</span><span class="n">params</span> <span class="nl">setValue:</span><span class="err">@”</span><span class="n">soulhacker</span><span class="err">@</span><span class="n">matrix</span><span class="p">.</span><span class="n">net</span><span class="err">”</span> <span class="nl">forParam:</span><span class="err">@”</span><span class="n">email</span><span class="err">”</span><span class="p">];</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">RKParamsAttachment</span><span class="o">*</span> <span class="n">attachment</span> <span class="o">=</span> <span class="p">[</span><span class="n">params</span> <span class="nl">setFile:</span><span class="n">filePath</span> <span class="nl">forParam:</span><span class="err">@”</span><span class="n">avatar</span><span class="err">”</span><span class="p">];</span>
</span><span class='line'><span class="n">attachment</span><span class="p">.</span><span class="n">MIMEType</span> <span class="o">=</span> <span class="err">@”</span><span class="n">image</span><span class="o">/</span><span class="n">jpeg</span><span class="err">”</span><span class="p">;</span>
</span><span class='line'><span class="n">attachment</span><span class="p">.</span><span class="n">fileName</span> <span class="o">=</span> <span class="err">@”</span><span class="n">avatar</span><span class="p">.</span><span class="n">jpg</span><span class="err">”</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">UIImage</span><span class="o">*</span> <span class="n">image</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIImage</span> <span class="nl">imageNamed:</span><span class="err">@”</span><span class="n">wallpaper</span><span class="p">.</span><span class="n">png</span><span class="err">”</span><span class="p">];</span>
</span><span class='line'><span class="n">NSData</span><span class="o">*</span> <span class="n">imageData</span> <span class="o">=</span> <span class="n">UIImagePNGRepresentation</span><span class="p">(</span><span class="n">image</span><span class="p">);</span>
</span><span class='line'><span class="p">[</span><span class="n">params</span> <span class="nl">setData:</span><span class="n">imageData</span> <span class="nl">MIMEType:</span><span class="err">@”</span><span class="n">image</span><span class="o">/</span><span class="n">png</span><span class="err">”</span> <span class="nl">forParam:</span><span class="err">@”</span><span class="n">wallpaper</span><span class="err">”</span><span class="p">];</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">NSLog</span><span class="p">(</span><span class="err">@”</span><span class="n">ContentType</span> <span class="o">=</span> <span class="o">%</span><span class="err">@</span><span class="p">,</span> <span class="n">ContentLength</span> <span class="o">=</span> <span class="o">%</span><span class="err">@”</span><span class="p">,</span>
</span><span class='line'>    <span class="p">[</span><span class="n">params</span> <span class="n">HTTPHeaderValueForContentType</span><span class="p">],</span>
</span><span class='line'>    <span class="p">[</span><span class="n">params</span> <span class="n">HTTPHeaderValueForContentLength</span><span class="p">]);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="c1">// Send a Request!</span>
</span><span class='line'><span class="p">[[</span><span class="n">RKClient</span> <span class="n">sharedClient</span><span class="p">]</span> <span class="nl">post:</span><span class="err">@”</span><span class="o">/</span><span class="n">upload</span><span class="err">”</span> <span class="nl">params:</span><span class="n">params</span> <span class="nl">delegate:</span><span class="n">self</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h3 id="background-uploaddownload">Background Upload/Download</h3>
<p>iOS supported multi-tasking since 4.0 but it’s a highly restricted support and there are so many misconceptions among the users and even developers. I would strongly suggest Fraser Speirs’ <a href="http://speirs.org/blog/2012/1/2/misconceptions-about-ios-multitasking.html">excellent blog</a> which explains all about iOS multi-tasking.</p>

<p>RestKit can seamlessly facilitate multi-tasking to prevent important long-time requests being interrupted by user switching out of the app. The key is the <code>backgroundPolicy</code> property of <code>RKRequest</code> which can be one of 4 enum values: </p>

<ul>
  <li><code>RKRequestBackgroundPolicyNone</code>: the default value, do nothing for backgrounding;</li>
  <li><code>RKRequestBackgroundPolicyCancel</code>: cancel the request when app switches to background;</li>
  <li><code>RKRequestBackgroundPolicyContinue</code>: continue the request in background;</li>
  <li><code>RKRequestBackgroundPolicyRequeue</code>: place the request back to the queue for next activation.</li>
</ul>

<p>So to make a request continue to work in background, just set its <code>backgroundPolicy</code> property as below:
<div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">RKRequest</span><span class="o">*</span> <span class="n">request</span> <span class="o">=</span> <span class="p">[[</span><span class="n">RKClient</span> <span class="n">sharedClient</span><span class="p">]</span> <span class="nl">post:</span><span class="err">@”</span><span class="o">/</span><span class="n">upload</span><span class="err">”</span> <span class="nl">delegate:</span><span class="n">self</span><span class="p">];</span>
</span><span class='line'><span class="n">request</span><span class="p">.</span><span class="n">backgroundPolicy</span> <span class="o">=</span> <span class="n">RKRequestBackgroundPolicyContinue</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h3 id="conclusion">Conclusion</h3>
<p>RestKit is a clean and elegant solution for iOS app to interact with RESTful web services. It encapsulates many everyday work into a tiny yet powerful framework and extremely easy to use. Suggest every iOS developers to give it a try.</p>

<h3 id="references">References</h3>
<ul>
  <li><a href="http://restkit.org/api/master/">RestKit References (master branch)</a></li>
  <li><a href="https://github.com/RestKit/RestKit/wiki/Tutorial-%3A-Introduction-to-RestKit">Tutorial: Introduction to RestKit</a></li>
  <li><a href="http://mobile.tutsplus.com/tutorials/iphone/advanced-restkit-development_iphone-sdk/">Advanced RestKit Development</a></li>
  <li><a href="https://github.com/RestKit/RestKit/wiki/Solution-Recipes">RestKit Solution Recipes</a></li>
</ul>
<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>In fact ASIHTTPRequest has been <a href="http://allseeing-i.com/%5Brequest_release%5D">abandoned</a> since September 2011, and RestKit is one of replacements its author suggested.  <a href="#fnref:1" rel="reference">&#8617;</a></p>
    </li>
    <li id="fn:2">
      <p>The JSON parsing layer is pluggable, default to <a href="https://github.com/johnezang/JSONKit">JSONKit</a>. And I haven’t mentioned the <em>old</em> XML, have I?  <a href="#fnref:2" rel="reference">&#8617;</a></p>
    </li>
    <li id="fn:3">
      <p>Created by <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#106;&#118;&#101;&#114;&#107;&#111;&#101;&#121;&#064;&#103;&#109;&#097;&#105;&#108;&#046;&#099;&#111;&#109;">Jeff Verkoeyen</a>, the author of <a href="https://github.com/jverkoey/nimbus">Nimbus</a>, the highly improved successor of Facebook’s Three20.<a href="#fnref:3" rel="reference">&#8617;</a></p>
    </li>
  </ol>
</div>
]]></content>
  </entry>
  
</feed>
